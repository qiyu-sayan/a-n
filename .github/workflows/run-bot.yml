name: run-bot

on:
  schedule:
    - cron: "*/5 * * * *"   # æ¯5åˆ†é’Ÿè·‘ä¸€æ¬¡ï¼ˆä½ å¯ä»¥æŒ‰éœ€æ”¹ï¼‰
  workflow_dispatch:

jobs:
  trade:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # âœ… æ–°å¢ï¼šæ¨é€å½“å‰ç­–ç•¥å‚æ•°å¿«ç…§
      - name: Push current params snapshot
        if: ${{ secrets.WECHAT_WEBHOOK != '' }}
        env:
          WECHAT_WEBHOOK: ${{ secrets.WECHAT_WEBHOOK }}
        run: |
          SNAPSHOT=$(jq -c '.' config/params.json)
          MSG="ğŸ§© å½“å‰ç­–ç•¥å‚æ•°\n${SNAPSHOT}"
          curl -sS -X POST "$WECHAT_WEBHOOK" \
            -H "Content-Type: application/json" \
            -d "{\"msgtype\":\"text\",\"text\":{\"content\":\"${MSG}\"}}"

      - name: Run trading bot
        env:
          BINANCE_KEY: ${{ secrets.BINANCE_KEY }}
          BINANCE_SECRET: ${{ secrets.BINANCE_SECRET }}
          BINANCE_TESTNET: ${{ secrets.BINANCE_TESTNET }}
          WECHAT_WEBHOOK: ${{ secrets.WECHAT_WEBHOOK }}
        run: |
          python bot/main.py