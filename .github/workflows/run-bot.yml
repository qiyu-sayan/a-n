name: run-bot

on:
  schedule:
    # 每 5 分钟运行一次（你可以自己改）
    - cron: "*/5 * * * *"
  workflow_dispatch:

permissions:
  contents: read

jobs:
  trade:
    runs-on: self-hosted

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      - name: Run trading bot
        env:
          BINANCE_KEY: ${{ secrets.BINANCE_KEY }}
          BINANCE_SECRET: ${{ secrets.BINANCE_SECRET }}
          TESTNET: "true"          # 现在你用的是测试网 API，保持 true
          ENABLE_TRADING: "true"   # 想只看日志不下单就改成 "false"
        run: |
          mkdir -p logs
          python bot/main.py 2>&1 | tee "logs/run-$(date -u '+%Y-%m-%dT%H-%M-%SZ').log"
